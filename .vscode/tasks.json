{
  "version": "2.0.0",
  "problemMatchers": [
    {
      "name": "mcp-dataverse-server-background",
      "owner": "mcp-dataverse-server",
      "pattern": [
        {
          "regexp": "^(?!x)x(.*)$",
          "file": 1,
          "message": 1
        }
      ],
      "background": {
        "activeOnStart": true,
        "beginsPattern": "Started server process",
        "endsPattern": "Uvicorn running on"
      }
    }
  ],
  "tasks": [
    {
      "label": "Stop MCP Dataverse Server (8000)",
      "type": "shell",
      "command": "$port = 8000; $listenerPids = @(Get-NetTCPConnection -LocalPort $port -ErrorAction SilentlyContinue | Where-Object { $_.State -eq 'Listen' } | Select-Object -ExpandProperty OwningProcess -Unique); $mcpPids = @(); try { $mcpPids = @(Get-CimInstance Win32_Process -ErrorAction SilentlyContinue | Where-Object { $_.CommandLine -like '*-m mcp_dataverse_server*' } | Select-Object -ExpandProperty ProcessId -Unique) } catch { $mcpPids = @() }; $pids = @($listenerPids + $mcpPids | Sort-Object -Unique); if ($pids -and $pids.Count -gt 0) { foreach ($procId in $pids) { Write-Output ('Stopping MCP server process (PID ' + $procId + ')'); Stop-Process -Id $procId -Force -ErrorAction SilentlyContinue }; Start-Sleep -Milliseconds 750 } else { Write-Output ('No MCP server process found; no LISTEN socket on ' + $port) }; $remaining = @(Get-NetTCPConnection -LocalPort $port -ErrorAction SilentlyContinue | Where-Object { $_.State -eq 'Listen' }); if ($remaining -and $remaining.Count -gt 0) { Write-Output ('WARNING: Port ' + $port + ' still has a listener'); $remaining | Select-Object LocalAddress,LocalPort,OwningProcess,State | Format-Table -AutoSize | Out-String } else { Write-Output ('Port ' + $port + ' is free') }",
      "problemMatcher": []
    },
    {
      "label": "Start MCP Dataverse Server",
      "type": "shell",
      "command": "$port = 8000; $listenerPids = @(Get-NetTCPConnection -LocalPort $port -ErrorAction SilentlyContinue | Where-Object { $_.State -eq 'Listen' } | Select-Object -ExpandProperty OwningProcess -Unique); $mcpPids = @(); try { $mcpPids = @(Get-CimInstance Win32_Process -ErrorAction SilentlyContinue | Where-Object { $_.CommandLine -like '*-m mcp_dataverse_server*' } | Select-Object -ExpandProperty ProcessId -Unique) } catch { $mcpPids = @() }; $pids = @($listenerPids + $mcpPids | Sort-Object -Unique); if ($pids -and $pids.Count -gt 0) { foreach ($procId in $pids) { Write-Output ('Stopping existing MCP server process (PID ' + $procId + ')'); Stop-Process -Id $procId -Force -ErrorAction SilentlyContinue }; Start-Sleep -Milliseconds 750 }; $py = Join-Path '${workspaceFolder}' '.venv\\Scripts\\python.exe'; Set-Location '${workspaceFolder}\\mcp-dataverse-server'; & $py -m mcp_dataverse_server",
      "isBackground": true,
      "problemMatcher": "$mcp-dataverse-server-background"
    },
    {
      "label": "Validate Logic App ARM Template",
      "type": "shell",
      "command": "az deployment group validate --resource-group ${input:resourceGroup} --template-file templates/azuredeploy.json --parameters @parameters/dev.parameters.json --parameters @parameters/dev.secrets.parameters.json",
      "problemMatcher": []
    },
    {
      "label": "Deploy Logic App to Azure",
      "type": "shell",
      "command": "az deployment group create --resource-group ${input:resourceGroup} --template-file templates/azuredeploy.json --parameters @parameters/dev.parameters.json --parameters @parameters/dev.secrets.parameters.json",
      "problemMatcher": []
    }
  ],
  "inputs": [
    {
      "id": "resourceGroup",
      "type": "promptString",
      "description": "Enter the Azure Resource Group name"
    }
  ]
}